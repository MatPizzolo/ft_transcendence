<!-- index.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Chat</title>
    <style>
        /* Add your custom styles here */
        #chat-box {
            height: 300px;
            overflow-y: scroll;
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
        }

        #user-list {
            float: left;
            width: 200px;
            height: 300px;
            overflow-y: scroll;
            border: 1px solid #ccc;
            padding: 10px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div>
        <label for="client-id">Client ID:</label>
        <input type="text" id="client-id" />
        <button onclick="connect()">Connect</button>
        <button onclick="disconnect()">Disconnect</button>
        <button onclick="getListofUsers()">Get User List</button>
    </div>

    <div id="user-list"></div>

    <div>
        <div id="chat-box"></div>
        <input type="text" id="chat-message" />
        <button onclick="sendMessage()">Send</button>
    </div>

    <script>
        const clientIDInput = document.getElementById('client-id');
        const chatBox = document.getElementById('chat-box');
        const userList = document.getElementById('user-list');
        const chatMessageInput = document.getElementById('chat-message');

        let socket = null;

        function connect() {
            const clientID = clientIDInput.value;
            if (clientID.trim() === '') {
                alert('Please enter a valid Client ID.');
                return;
            }

            socket = new WebSocket(`ws://127.0.0.1:8000/ws/lobby/?client_id=${clientID}`);

            socket.onopen = (event) => {
                console.log('WebSocket Connection opened:', event);
            };

            socket.onmessage = (event) => {
                const data = JSON.parse(event.data);
                handleWebSocketData(data);
            };

            socket.onclose = (event) => {
                console.log('WebSocket Connection closed:', event);
            };
        }

        function disconnect() {
            if (socket !== null) {
                socket.close();
                socket = null;
            }
        }

        function sendMessage() {
            const message = chatMessageInput.value;
            if (message.trim() !== '' && socket !== null) {
                const data = {
                    type: 'chat_message',
                    data: { message },
                };
                socket.send(JSON.stringify(data));
                chatMessageInput.value = '';
            }
        }

        function getListofUsers() {
            if (socket !== null) {
                const data = {
                    type: 'get_list_users',
                };
                socket.send(JSON.stringify(data));
            }
        }

        function handleWebSocketData(data) {
            const messageType = data.type;
            const messageData = data.data;

            switch (messageType) {
                case 'list_of_users':
                    updateUserList(messageData.message);
                    break;

                case 'chat_message':
                    updateChatBox(messageData.sender, messageData.message);
                    break;

                // Add more cases for other message types as needed

                default:
                    console.log('Unhandled message type:', messageType);
            }
        }

        function updateUserList(users) {
            userList.innerHTML = '<strong>Connected Users:</strong>';
            users.forEach(user => {
                const userItem = document.createElement('div');
                userItem.textContent = user;
                userList.appendChild(userItem);
            });
        }

        function updateChatBox(sender, message) {
            const chatMessage = document.createElement('div');
            chatMessage.textContent = `${sender}: ${message}`;
            chatBox.appendChild(chatMessage);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    </script>
</body>
</html>
