<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Chat</title>
</head>
<body>

<h1>WebSocket Chat</h1>

<label for="client_id">Enter Client ID:</label>
<input type="text" id="client_id" placeholder="Enter your client ID">
<button onclick="connectToWebSocket()">Connect</button>

<hr>

<h2>Chat Room</h2>
<div id="chat" style="height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;"></div>

<label for="message">Message:</label>
<input type="text" id="message" placeholder="Type your message">
<button onclick="sendMessage()">Send</button>

<script>
    const clientIDInput = document.getElementById('client_id');
    const chatDiv = document.getElementById('chat');
    const messageInput = document.getElementById('message');

    let socket;

    function connectToWebSocket() {
        const clientID = clientIDInput.value.trim();
        if (!clientID) {
            alert('Please enter a valid client ID');
            return;
        }

        // Establish WebSocket connection
        socket = new WebSocket(`ws://localhost:8000/ws/lobby/?client_id=${clientID}`);

        // Set up WebSocket event listeners
        socket.addEventListener('open', (event) => {
            console.log('WebSocket connection opened:', event);
        });

        socket.addEventListener('message', (event) => {
            const data = JSON.parse(event.data);
            console.log('WebSocket message received:', data);

            if (data.type === 'message') {
                appendMessage(data.group_name, data.message);
            }
        });

        socket.addEventListener('close', (event) => {
            console.log('WebSocket connection closed:', event);
        });
    }

    function sendMessage() {
        const message = messageInput.value.trim();
        if (!message) {
            alert('Please enter a message');
            return;
        }

        // Send message to WebSocket
        socket.send(JSON.stringify({
            type: 'command',
            command: 'send_message',
            data: {
                group_name: 'website_lobby',
                message: message,
            }
        }));

        // Clear the message input
        messageInput.value = '';
    }

    function appendMessage(groupName, message) {
        const messageElement = document.createElement('div');
        messageElement.textContent = `[${groupName}] ${message}`;
        chatDiv.appendChild(messageElement);

        // Scroll to the bottom to show the latest message
        chatDiv.scrollTop = chatDiv.scrollHeight;
    }
</script>

</body>
</html>
